---
import "../styles/global.css";
import Header from "../components/Header.astro";
import Hero from "../components/Hero.astro";
import Benefits from "../components/Benefits.astro";
import CtaBanner from "../components/CtaBanner.astro";
import Pricing from "../components/Pricing.astro";
import Footer from "../components/Footer.astro";
---

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/LOGO_SAVANT.png" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>Savant Academia</title>
  </head>
  <body>
    <Header />
    <Hero />
    <Benefits />
    <CtaBanner />
    <Pricing />
    <Footer />

    <!-- Botón flotante de WhatsApp -->
    <a
      id="wspp-btn"
      href="https://wa.me/51996096191"
      class="fixed bottom-4 right-4 z-50 bg-[#25D366] hover:bg-[#1ebe5d] text-white p-6 rounded-full shadow-lg transition duration-300"
      target="_blank"
      rel="noopener noreferrer"
      aria-label="Contáctanos por WhatsApp"
    >
      <img src="/svg/whatsapp.svg" alt="WhatsApp" class="w-9 h-9" />
    </a>
  </body>
</html>

<script type="module" is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    // ✨ Animación CTA planes
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.remove("opacity-0");
            entry.target.classList.add("fade-up");
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.3 }
    );

    const ctaSection = document.querySelector("#planes");
    if (ctaSection) observer.observe(ctaSection);

    // ✨ Función para actualizar contenido dinámico
    const setContent = (
      whatsappURL,
      currencySymbol,
      hourlyPrices,
      packagePrices,
      titles
    ) => {
      const btn = document.getElementById("wspp-btn"); // Botón flotante
      const heroBtn = document.getElementById("wspp-hero"); // Botón del hero
      const currencySpans = document.querySelectorAll(
        "#precios .currency-symbol"
      );

      const priceEls = {
        individual: document.getElementById("precio-individual"),
        pack: document.getElementById("precio-pack"),
        intensivo: document.getElementById("precio-intensivo"),
      };

      const descEls = {
        individual: document.getElementById("descripcion-individual"),
        pack: document.getElementById("descripcion-pack"),
        intensivo: document.getElementById("descripcion-intensivo"),
      };

      const titleEls = {
        individual: document.getElementById("titulo-individual"),
        pack: document.getElementById("titulo-pack"),
        intensivo: document.getElementById("titulo-intensivo"),
      };

      if (btn) btn.href = whatsappURL;
      if (heroBtn) heroBtn.href = whatsappURL;

      currencySpans.forEach((el) => (el.textContent = currencySymbol));

      if (priceEls.individual && descEls.individual && titleEls.individual) {
        // Precios por hora
        priceEls.individual.textContent = hourlyPrices[0];
        priceEls.pack.textContent = hourlyPrices[1];
        priceEls.intensivo.textContent = hourlyPrices[2];

        // Descripciones de los paquetes
        descEls.individual.textContent = `Paquete de 8 horas por ${currencySymbol} ${packagePrices[0]}`;
        descEls.pack.textContent = `Paquete de 8 horas por ${currencySymbol} ${packagePrices[1]}`;
        descEls.intensivo.textContent = `Paquete de 8 horas por ${currencySymbol} ${packagePrices[2]}`;

        // Títulos de los planes
        titleEls.individual.textContent = titles[0];
        titleEls.pack.textContent = titles[1];
        titleEls.intensivo.textContent = titles[2];
      }
    };

    // ✨ Actualizar redes sociales del footer
    const updateFooterLinks = (code) => {
      const fbLink = document.querySelector('a[aria-label="Facebook"]');
      const igLink = document.querySelector('a[aria-label="Instagram"]');
      const wsLink = document.querySelector('a[aria-label="WhatsApp"]');

      if (code === "ES") {
        if (fbLink)
          fbLink.href =
            "https://www.facebook.com/profile.php?id=61574901986219";
        if (igLink) igLink.href = "https://www.instagram.com/academiazenedues";
        if (wsLink) wsLink.href = "https://wa.me/message/L5T6WXLAGYXFM1";
      } else {
        if (fbLink)
          fbLink.href =
            "https://www.facebook.com/profile.php?id=61570520392211";
        if (igLink) igLink.href = "https://www.instagram.com/academiazenedu/";
        if (wsLink) wsLink.href = "https://wa.me/51996096191";
      }
    };

    // ✨ Detectar país y aplicar cambios
    const updateContentForCountry = (code) => {
      if (code === "ES") {
        setContent(
          "https://wa.me/message/L5T6WXLAGYXFM1",
          "€",
          ["10", "12.5", "15"],
          ["70", "87.5", "100"],
          ["PRIMARIA - ESO", "BACHILLER", "UNIVERSITARIO"]
        );
      } else {
        setContent(
          "https://wa.me/51996096191",
          "S/.",
          ["25", "27.5", "30"],
          ["187.5", "207.5", "227.5"],
          ["ESCOLAR / PRE", "UNIVERSITARIO", "FACULTAD"]
        );
      }

      updateFooterLinks(code);

      // 👇 Mostrar u ocultar banner de promoción
      const promoBanner = document.getElementById("promo-banner");
      if (promoBanner) {
        if (code === "ES") {
          promoBanner.classList.remove("hidden"); // Mostrar el banner solo en España
        } else {
          promoBanner.classList.add("hidden"); // Ocultar (no ocupa espacio) en Perú y otros países
        }
      }

      const lottieMobile = document.getElementById("lottie-mobile");
      if (lottieMobile) {
        if (code === "PE") {
          lottieMobile.classList.remove("w-[310px]", "h-[310px]");
          lottieMobile.classList.add("w-[380px]", "h-[380px]");
        } else {
          // Por si acaso vuelve de otro país
          lottieMobile.classList.remove("w-[380px]", "h-[380px]");
          lottieMobile.classList.add("w-[310px]", "h-[310px]");
        }
      }
    };

    // 🔁 En desarrollo, simula país
    if (location.hostname === "localhost") {
      const simulated = "PE"; // Cambia a "ES" si quieres probar España localmente
      updateContentForCountry(simulated);
    } else {
      // Detecta por IP real en producción
      fetch("https://ipinfo.io/json?token=ce97066c11fc03")
        .then((res) => res.json())
        .then((data) => {
          updateContentForCountry(data.country);
        })
        .catch(() => {
          updateContentForCountry("PE");
        });
    }
  });
</script>
