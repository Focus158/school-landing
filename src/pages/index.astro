---
import "../styles/global.css";
import Header from "../components/Header.astro";
import Hero from "../components/Hero.astro";
import Benefits from "../components/Benefits.astro";
import CtaBanner from "../components/CtaBanner.astro";
import Pricing from "../components/Pricing.astro";
import Footer from "../components/Footer.astro";
---

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>ZenEdu</title>
  </head>
  <body>
    <Header />
    <Hero />
    <Benefits />
    <CtaBanner />
    <Pricing />
    <Footer />

    <!-- Botón flotante de WhatsApp -->
    <a
      id="wspp-btn"
      href="https://wa.me/51996096191"
      class="fixed bottom-4 right-4 z-50 bg-[#25D366] hover:bg-[#1ebe5d] text-white p-4 rounded-full shadow-lg transition duration-300"
      target="_blank"
      rel="noopener noreferrer"
      aria-label="Contáctanos por WhatsApp"
    >
      <img src="/svg/whatsapp.svg" alt="WhatsApp" class="w-6 h-6" />
    </a>
  </body>
</html>

<!-- Script para animaciones y detección por país -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    // Animación fade-in
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.remove("opacity-0");
            entry.target.classList.add("fade-up");
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.3 }
    );

    const ctaSection = document.querySelector("#planes");
    if (ctaSection) {
      observer.observe(ctaSection);
    }

    // Geolocalización por país
    const updateContentForCountry = (code: string) => {
      const btn = document.getElementById(
        "wspp-btn"
      ) as HTMLAnchorElement | null;
      if (!btn) return;

      const spans = document
        .querySelector("#precios")
        ?.querySelectorAll("p span.text-3xl");
      if (!spans || spans.length < 3) return;

      if (code === "PE") {
        btn.href = "https://wa.me/51996096191";
        spans[0].textContent = "30";
        spans[1].textContent = "100";
        spans[2].textContent = "220";
      } else if (code === "CL") {
        btn.href = "https://wa.me/56987654321";
        spans[0].textContent = "7000";
        spans[1].textContent = "24000";
        spans[2].textContent = "52000";
      } else if (code === "CO") {
        btn.href = "https://wa.me/573001234567";
        spans[0].textContent = "25000";
        spans[1].textContent = "85000";
        spans[2].textContent = "190000";
      }
    };

    // Detectar país real o simular
    if (location.hostname === "localhost") {
      const simulated = "PE"; // Cambia por 'PE', 'CO', etc. para pruebas
      console.log("País simulado (modo local):", simulated);
      updateContentForCountry(simulated);
    } else {
      fetch("https://ipinfo.io/json?token=ce97066c11fc03")
        .then((res) => res.json())
        .then((data) => {
          const code = data.country;
          console.log("País detectado en producción:", code);
          updateContentForCountry(code);
        })
        .catch(() => {
          console.log("Fallo en geolocalización. Usando país por defecto (PE)");
          updateContentForCountry("PE");
        });
    }
  });
</script>
